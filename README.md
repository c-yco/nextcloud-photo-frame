# Nextcloud Photo Discovery App

A Dockerized application that displays random photos from a Nextcloud instance with weighted selection based on recency and "favorite" status.

## Architecture

- **App**: Flask web interface to display photos.
- **Worker**: Background process that scans Nextcloud via WebDAV, extracts EXIF data, and updates Redis.
- **Redis**: Stores photo metadata and weights.


## Setup

1.  Copy the example environment file:
    ```bash
    cp example.env .env
    ```

2.  Edit `.env` with your Nextcloud credentials.
    *   **NC_URL**: Your Nextcloud WebDAV URL (e.g., `https://cloud.example.com/remote.php/dav/files/your_username`).
    *   **NC_USER**: Your Nextcloud username.
    *   **NC_PASS**: An App Password (generated in Nextcloud Security settings).
    *   **NC_PHOTO_PATH**: The folder to scan (e.g., `/Photos/`).
    *   **IGNORE_FILE**: (Optional) Filename that, if present in a directory, causes the scanner to skip that directory and its subdirectories (default: `.ignore`).
    *   **SCAN_CRON**: Scan schedule in cron syntax (default: `0 1 * * *` = daily at 1 AM).
    *   **WEATHER_LAT** / **WEATHER_LON**: (Optional) Coordinates for weather display.
    *   **APP_LANG**: Language code (en, de, fr, es). Default: en.
    *   **SHOW_QR_CODE**: (Optional) Show a QR code linking to the original photo on Nextcloud. Set to `true` to enable.
    *   **APP_RELOAD_INTERVAL**: (Optional) Time in seconds between photo changes. Default: `30`.
    *   **APP_QUIET_TIME**: (Optional) Quiet time ranges where photos won't change (e.g., `22:00-06:00`). Supports multiple ranges separated by commas (e.g., `12:00-13:00,22:00-06:00`).

3.  Run with Docker Compose:
    ```bash
    # Pull the latest images from GitHub Container Registry
    docker-compose pull

    # Start the stack
    docker-compose up -d
    ```

    *Alternatively, to build locally:*
    ```bash
    docker-compose up -d --build
    ```

3.  Access the app at `http://localhost`.

## Features

- **Weighted Random Selection**: Recent photos (last 3 months) and Favorites get higher priority.
- **EXIF Data**: Displays date taken and GPS status.
- **Image Proxy**: Serves images securely from Nextcloud through the app.
- **Weather Display**: Shows current and tomorrow's weather (requires lat/lon config). Get LAT & LON values from https://www.latlong.net/ for example

## Persistence

The application uses a Docker volume (`redis_data`) to persist the photo index and cache. This means:
- The photo index survives container restarts.
- You don't need to re-scan your entire library every time you restart the app.

To clear the index and start fresh:
```bash
docker-compose down -v
docker-compose up --build
```

## AI Disclaimer

This project was entirely generated by AI (GitHub Copilot) based on user requirements. The code, architecture, and documentation were synthesized by the AI model.
